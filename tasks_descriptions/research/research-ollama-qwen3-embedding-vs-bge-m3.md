# Research Task: Ollama integration for Qwen3-Embedding vs bge-m3

## Контекст
- В текущем planning-контуре Stage 3 остался открытый вопрос по работе embedding-провайдера через Ollama.
- Нужно уточнить различия в практической интеграции между моделями `qwen3-embedding` и `bge-m3`.
- Результат исследования будет использован для корректной реализации backend adapter и UI settings (provider/model parameters).

## Цель исследования
Подготовить точные, проверяемые рекомендации по тому, как вызывать embeddings в Ollama для `qwen3-embedding` и `bge-m3`, какие параметры поддерживаются, и как унифицировать это в contract/backend без потери совместимости.

## Что нужно прояснить (вопросы)
1. Какой актуальный API вызова embeddings в Ollama нужно использовать (endpoint, request/response формат) для обеих моделей?
2. Есть ли различия в обязательных/рекомендуемых параметрах запроса для `qwen3-embedding` и `bge-m3`?
3. Поддерживают ли модели batch input одинаково, и есть ли ограничения по размеру batch / длине текста?
4. Есть ли различия по размерности вектора (embedding dimension), и как это учитывать в vector DB (например, Qdrant collection schema)?
5. Какие значения по умолчанию (defaults) безопасно выставлять в нашем проекте для каждой модели?
6. Какие ошибки чаще всего возникают при вызове каждой модели через Ollama и как их корректно нормализовать в `error envelope`?
7. Какие параметры являются модель-специфичными, а какие можно оставить в общем provider contract?
8. Нужна ли отдельная ветка логики в backend adapter для `qwen3-embedding` и `bge-m3`, или достаточно strategy-конфигурации?
9. Какие тест-кейсы (L2 contract + unit/integration) обязательны, чтобы покрыть различия между этими моделями?

## Требуемые артефакты от исследователя
1. Краткая сравнительная таблица: `qwen3-embedding` vs `bge-m3` (API, params, dims, limits, known issues).
2. Минимальные рабочие примеры запросов к Ollama для обеих моделей.
3. Рекомендованный normalized contract для нашего backend (какие поля обязательные/опциональные).
4. Рекомендованная схема маппинга ошибок в `error envelope`.
5. Набор конкретных test cases для L2/L3 уровней.

## Критерии готовности (Definition of Done)
- [ ] Для обеих моделей зафиксирован подтвержденный способ вызова через Ollama с примерами.
- [ ] Описаны различия параметров и ограничения, влияющие на реализацию.
- [ ] Предложен единый contract-слой и отмечены model-specific поля.
- [ ] Подготовлены рекомендации для backend adapter, UI settings и тестов.
- [ ] Все ключевые выводы снабжены ссылками на первоисточники (официальная документация/репозитории).

## Формат ответа от Gemini 3 Pro
- Раздел 1: Verified Facts (с источниками)
- Раздел 2: Integration Decisions for code-rag
- Раздел 3: Contract Proposal (draft fields + examples)
- Раздел 4: Test Plan Additions
- Раздел 5: Risks / Unknowns

